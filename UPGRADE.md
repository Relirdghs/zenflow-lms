# Инструкция по обновлению до версии 2.2

Если вы уже запустили ZenFlow и хотите обновиться до версии 2.2 с новыми возможностями, следуйте этой инструкции.

## Что нового в версии 2.2

- ✅ Управление группами: аватары, участники
- ✅ Приватные курсы и доступ через группы
- ✅ Админ и супер-админ не видят клиентскую панель `/dashboard`

---

## Шаг 0: Миграции 2.2

Выполните новые миграции:

1. **Откройте Supabase Dashboard** → **SQL Editor**
2. **Запустите по очереди:**
   - `supabase/migrations/00005_group_members_and_avatars.sql`
   - `supabase/migrations/00006_course_visibility_and_group_access.sql`

---

## Далее — шаги версии 2.0

## Что нового в версии 2.0

- ✅ Интернационализация (i18n) — подготовка для русского, казахского и английского языков
- ✅ Русский интерфейс по умолчанию
- ✅ Новые типы блоков: H1, H2, Callout, Link
- ✅ Drag-and-drop загрузка обложки курса
- ✅ Кнопки "Вверх/Вниз" для перестановки блоков (вместо drag-and-drop)
- ✅ Улучшенный Slider с изменением порядка изображений
- ✅ Визуальный редактор блоков
- ✅ Скрипт для подтверждения email пользователей

---

## Шаг 1: Обновление кода

Код уже обновлен. Если вы клонировали репозиторий, выполните:

```bash
git pull
npm install
```

---

## Шаг 2: Миграция базы данных

Выполните новую миграцию для добавления новых типов блоков:

1. **Откройте Supabase Dashboard** → **SQL Editor**

2. **Откройте файл** `supabase/migrations/00002_add_new_block_types.sql`

3. **Скопируйте содержимое** файла

4. **Вставьте в SQL Editor** и нажмите **"Run"**

Миграция добавит 4 новых типа блоков: `h1`, `h2`, `callout`, `link`.

---

## Шаг 3: Обновление зависимостей

Установите новый пакет `dotenv` (если еще не установлен):

```bash
npm install -D dotenv
```

---

## Шаг 4: Проверка работы

1. Запустите dev сервер:
   ```bash
   npm run dev
   ```

2. Откройте админ-панель и создайте новый урок

3. В ZenBuilder попробуйте добавить новые блоки:
   - Заголовок H1
   - Заголовок H2
   - Важное (Callout)
   - Ссылка

4. Попробуйте переместить блоки кнопками "Вверх/Вниз"

---

## Что делать, если что-то не работает

### Ошибка "type block_type does not exist"

**Решение:** Выполните миграцию 00002_add_new_block_types.sql в SQL Editor.

### Ошибка при загрузке изображений

**Решение:** 
- Компонент ImageUpload использует Data URL для preview
- Для production настройте Supabase Storage (см. SUPABASE_SETUP.md, Шаг 6)
- Обновите компонент ImageUpload для загрузки в Storage

### Старые блоки не отображаются

**Решение:**
- Старые блоки (video, text, image, slider, quiz, checklist, timer) по-прежнему поддерживаются
- Убедитесь, что выполнена миграция 00001_zenflow_schema.sql

---

## Обратная совместимость

Все существующие курсы, уроки и блоки продолжают работать. Новые типы блоков добавлены, старые не изменены.

Если вы не хотите использовать новые блоки, просто не добавляйте их — всё будет работать как раньше.

---

## Полезные команды

```bash
# Подтвердить email всех пользователей (для разработки)
npm run confirm-users

# Пересоздать тестовые данные
npm run seed

# Проверить билд
npm run build
```

---

## Поддержка

Если возникли проблемы при обновлении, см.:
- [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) — настройка Supabase
- [CHANGELOG.md](./CHANGELOG.md) — полный список изменений
- [README.md](./README.md) — общая документация
